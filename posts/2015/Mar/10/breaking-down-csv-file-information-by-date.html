<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Too many files that had dated data that I needed to reconcile to a small range of dates."><meta name="author" content="Larry G. Wapnitsky"><meta name="generator" content="Pelican (VoidyBootstrap theme)"><meta property="fb:app_id" content="105212313145043"><meta property="og:type" content="article"><meta property="og:title" content="Breaking down CSV file information by date"><meta property="og:url" content="http://larry.wapnitsky.com/posts/2015/Mar/10/breaking-down-csv-file-information-by-date.html"><meta property="og:description" content="Too many files that had dated data that I needed to reconcile to a small range of dates."><meta property="article:section" content="programming"><meta property="article:tag" content="programming"><meta property="article:tag" content="PowerShell"><meta property="article:tag" content="scripting"><meta property="article:tag" content="IT"><meta property="og:image" content="http://larry.wapnitsky.com/images/programming/powershell2xa4.jpg"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Breaking down CSV file information by date"><meta name="twitter:description" content="Too many files that had dated data that I needed to reconcile to a small range of dates."><meta name="twitter:site" content="@lgwapnitsky"><meta name="twitter:creator" content="@lgwapnitsky"><meta name="twitter:domain" content="http://larry.wapnitsky.com"><meta property="twitter:image" content="http://larry.wapnitsky.com/images/programming/powershell2xa4.jpg"><title>Breaking down CSV file information by date - Larry G. Wapnitsky's Random Ramblings</title><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="http://larry.wapnitsky.com/theme/css/pygments/solarizeddark.css"><link rel="stylesheet" href="http://larry.wapnitsky.com/theme/css/voidybootstrap_lgw.css"><!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]--><link rel="shortcut icon" href="http://larry.wapnitsky.com/favicon.ico"><link href="http://larry.wapnitsky.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Larry G. Wapnitsky's Random Ramblings Atom Feed"><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49725155-1', '');
  ga('send', 'pageview');

</script></head><body><nav class="navbar navbar-default" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="http://larry.wapnitsky.com/" rel="home"><i class="fa fa-home fa-fw fa-lg"> </i> </a></div><div class="collapse navbar-collapse" id="main-navbar-collapse"><ul class="nav navbar-nav"><li><a href="/category/news/">News</a></li><li><a href="/category/reviews/">Reviews</a></li><li><a href="/category/programming/">Programming</a></li><li><a href="/pages/about/">About LGW</a></li><li class><a href="http://larry.wapnitsky.com/archives.html">Archives</a></li><li class="divider"></li><li><a href="http://larry.wapnitsky.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"><i class="fa fa-rss fa-fw fa-lg"></i> </a></li></ul> </div> </div> </nav> <div class="jumbotron" id="overview"><div class="container"><h1><a href="http://larry.wapnitsky.com/">Larry G. Wapnitsky's Random Ramblings</a></h1><p class="lead">a guy who does stuff</p></div></div><div class="container" id="main-container"><div class="row"><div class="col-md-9" id="content"><article itemscope="itemscope" itemtype="http://schema.org/BlogPosting"><header class="article-header"><abbr class="article-header-date"> 2015-March-10 </abbr> <h1><a href="http://larry.wapnitsky.com/posts/2015/Mar/10/breaking-down-csv-file-information-by-date.html" rel="bookmark" title="Permalink to Breaking down CSV file information by date"> Breaking down <span class="caps">CSV</span> file information by&nbsp;date </a></h1><div class="article-header-info"><p> in <a href="http://larry.wapnitsky.com/category/programming"> programming</a>&nbsp;&nbsp;</p></div> </header><div class="content-body" itemprop="text articleBody"><p>I had a need this morning to reconcile some reporting data for a large number of projects in Microsoft <span class="caps">TFS</span>. I exported the data using Team Foundation Sidekicks, but needed to break down the data by month within a certain range of dates. Here&rsquo;s how I did it. </p><p>Let&rsquo;s break it down into&nbsp;steps:</p><p><strong>I needed to bring in all <span class="caps">CSV</span> files from my current directory that were greater than 0&nbsp;bytes.</strong></p><div class="highlight"><pre><span class="x">$files = dir *.csv | where </span><span class="cp">{</span><span class="nv">$_.length</span> <span class="o">-</span><span class="na">gt</span> <span class="m">0</span><span class="cp">}</span><span class="x"></span>
</pre></div><p>Why not bring them all in even if they are 0 bytes? There&rsquo;s no need to use memory to collect unnecessary garbage. Let&rsquo;s avoid it at the beginning rather than wasting processing power and&nbsp;memory.</p><p><strong>Now we need to iterate through this file list and process them&nbsp;one-by-one.</strong></p><div class="highlight"><pre><span class="p">$</span><span class="nv">z</span><span class="x"> = foreach (</span><span class="p">$</span><span class="nv">file</span><span class="x"> in </span><span class="p">$</span><span class="nv">files</span><span class="x">) </span><span class="err">{</span><span class="x"></span>
<span class="x">    write-progress -id 1 -activity </span><span class="p">$</span><span class="nv">file</span><span class="p">.</span><span class="nv">name</span><span class="x"> -status &quot;processing...&quot;</span>
<span class="x">    </span><span class="p">$</span><span class="nv">x</span><span class="x"> = import-csv </span><span class="p">$</span><span class="nv">file</span><span class="x"></span>
</pre></div><p><code>$z</code> will be used to store the data returned from iterating through every&nbsp;file.</p><p>I like to use <code>write-progress</code> when I&rsquo;m iterating through large lists\dictionaries\arrays. It helps me keep track of where I am within that list and see if I need to break out. It&rsquo;s also better than constantly writing to the screen using <code>write-host</code>, as that data can wind up in our collection of objects&nbsp;below.</p><p><strong>Extract information from each&nbsp;file</strong></p><p>Now we&rsquo;re going to iterate through records of the file that&rsquo;s been imported. We&rsquo;re going to create a custom object that&nbsp;contains:</p><ul><li>Project&nbsp;Name</li><li>Total commits in the&nbsp;project</li><li>Total commits in<ul><li>November&nbsp;2014</li><li>December&nbsp;2014</li><li>January&nbsp;2015</li><li>February&nbsp;2015</li></ul></li></ul><div class="highlight"><pre><span class="x">    </span><span class="p">$</span><span class="nv">y</span><span class="x"> = new-object -type psobject -Property @</span><span class="err">{</span><span class="x"></span>
<span class="x">        Project = </span><span class="p">$</span><span class="nv">file</span><span class="p">.</span><span class="nv">basename</span><span class="x"></span>
<span class="x">        Total = </span><span class="p">$</span><span class="nv">x</span><span class="p">.</span><span class="nv">count</span><span class="x"></span>
<span class="x">        Nov2014 = (</span><span class="p">$</span><span class="nv">x</span><span class="x"> | where </span><span class="err">{</span><span class="x">(</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -ne </span><span class="p">$</span><span class="nv">null</span><span class="x">) -and ([datetime]</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -gt [datetime]::parse(&quot;11-1-2014&quot;)) -and ([datetime]</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -lt [datetime]::parse(&quot;12-1-2014&quot;))}).count</span>
<span class="x">        Dec2014 = (</span><span class="p">$</span><span class="nv">x</span><span class="x"> | where </span><span class="err">{</span><span class="x">(</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -ne </span><span class="p">$</span><span class="nv">null</span><span class="x">) -and ([datetime]</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -gt [datetime]::parse(&quot;12-1-2014&quot;)) -and ([datetime]</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -lt [datetime]::parse(&quot;1-1-2015&quot;))}).count</span>
<span class="x">        Jan2015 = (</span><span class="p">$</span><span class="nv">x</span><span class="x"> | where </span><span class="err">{</span><span class="x">(</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -ne </span><span class="p">$</span><span class="nv">null</span><span class="x">) -and ([datetime]</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -gt [datetime]::parse(&quot;1-1-2015&quot;)) -and ([datetime]</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -lt [datetime]::parse(&quot;2-1-2015&quot;))}).count</span>
<span class="x">        Feb2015 = (</span><span class="p">$</span><span class="nv">x</span><span class="x"> | where </span><span class="err">{</span><span class="x">(</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -ne </span><span class="p">$</span><span class="nv">null</span><span class="x">) -and ([datetime]</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -gt [datetime]::parse(&quot;2-1-2015&quot;)) -and ([datetime]</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">date</span><span class="x"> -lt [datetime]::parse(&quot;3-1-2015&quot;))}).count</span>
<span class="x">    }</span>
</pre></div><p><strong>Store the data and report&nbsp;it</strong></p><p>Now we&rsquo;re going to output the created object <code>$y</code> and store it in <code>$z</code> for&nbsp;reporting.</p><p>Following the final file, we will then output the objects in <code>$z</code> to a <span class="caps">CSV</span> file, specifying <code>NoTypeInformation</code> to make the <span class="caps">CSV</span> more univerally&nbsp;readable.</p><div class="highlight"><pre><span class="x">    </span><span class="p">$</span><span class="nv">y</span><span class="x"></span>
<span class="x">}</span>
<span class="p">$</span><span class="nv">z</span><span class="x"> | select Project,Total,Nov2014,Dec2014,Jan2015,Feb2015 | export-csv -NoTypeInformation TFS_Nov2014-Feb2015Activity.csv</span>
</pre></div><p><strong>Let&rsquo;s put it all&nbsp;together</strong></p><p>When all the above is combined, your script will look like&nbsp;this:</p><div class="gist"><script src="https://gist.github.com/31deaf16727762151bae.js"></script><noscript><pre><code>$files = dir *.csv | where {$_.length -gt 0}

$z = foreach ($file in $files) {
	write-progress -id 1 -activity $file.name -status "processing..."
	$x = import-csv $file
	$y = new-object -type psobject -Property @{
		Project = $file.basename
		Total = $x.count
		Nov2014 = ($x | where {($_.date -ne $null) -and ([datetime]$_.date -gt [datetime]::parse("11-1-2014")) -and ([datetime]$_.date -lt [datetime]::parse("12-1-2014"))}).count
		Dec2014 = ($x | where {($_.date -ne $null) -and ([datetime]$_.date -gt [datetime]::parse("12-1-2014")) -and ([datetime]$_.date -lt [datetime]::parse("1-1-2015"))}).count
		Jan2015 = ($x | where {($_.date -ne $null) -and ([datetime]$_.date -gt [datetime]::parse("1-1-2015")) -and ([datetime]$_.date -lt [datetime]::parse("2-1-2015"))}).count
		Feb2015 = ($x | where {($_.date -ne $null) -and ([datetime]$_.date -gt [datetime]::parse("2-1-2015")) -and ([datetime]$_.date -lt [datetime]::parse("3-1-2015"))}).count
	}
	$y
}
$z | select Project,Total,Nov2014,Dec2014,Jan2015,Feb2015 | export-csv -NoTypeInformation TFS_Nov2014-Feb2015Activity.csv</code></pre></noscript></div><h3>Summary</h3><p>While this does the job, there are much cleaner, more concise ways of accomplishing the same thing. I needed to burn this off as quickly as possible, so it came out quick and dirty. When I find time, I will update this post with better code. In the meantime, feel free to modify this code and adapt it to your own&nbsp;needs.</p></div><hr><div class="well well-sm"> <a href="https://twitter.com/share" class="twitter-share-button" data-via="lgwapnitsky">Tweet</a>&nbsp;<div class="g-plus" data-action="share" data-annotation="bubble"></div>&nbsp;&nbsp;&nbsp;&nbsp;<div class="g-plusone" data-size="medium"></div>&nbsp;<div class="fb-like" data-href="http://larry.wapnitsky.com/posts/2015/Mar/10/breaking-down-csv-file-information-by-date.html" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>&nbsp;</div> <p>This post is part 1 of the "PowerShell notes" series:</p><ol class="parts"><li class="partslist" class="active"><a href="http://larry.wapnitsky.com/posts/2015/Mar/10/breaking-down-csv-file-information-by-date.html">Breaking down <span class="caps">CSV</span> file information by&nbsp;date</a> ( 2015-March-10 ) </li><li class="partslist"><a href="http://larry.wapnitsky.com/posts/2015/Jul/23/splitting-a-csv-in-powershell.html">Splitting a <span class="caps">CSV</span> in&nbsp;PowerShell</a> ( 2015-March-10 ) </li></ol><div class="article-tag-list"><span class="label label-default">Tags</span><a href="http://larry.wapnitsky.com/tag/programming/"><i class="fa fa-tag"></i>programming</a>&nbsp;<a href="http://larry.wapnitsky.com/tag/powershell/"><i class="fa fa-tag"></i>PowerShell</a>&nbsp;<a href="http://larry.wapnitsky.com/tag/scripting/"><i class="fa fa-tag"></i>scripting</a>&nbsp;<a href="http://larry.wapnitsky.com/tag/it/"><i class="fa fa-tag"></i>IT</a>&nbsp;</div><div class="comments"><h2>Comments</h2><div id="disqus_thread"></div><script type="text/javascript">
				   (function() {
						var dsq = document.createElement('script');
						dsq.type = 'text/javascript'; dsq.async = true;
						dsq.src = '//larrygwapnitsky.disqus.com/embed.js';
						(document.getElementsByTagName('head')[0] ||
						 document.getElementsByTagName('body')[0]).appendChild(dsq);
				  })();
	</script></div></article></div><div class="col-md-3 sidebar-nav" id="sidebar"><div class="row"><div class="col-xs-6 col-md-12"><h4><i class="fa fa-comment fa-fw fa-lg"></i> Social</h4><ul class="list-unstyled social-links"><li><a href="https://www.facebook.com/larry.g.wapnitsky" target="_blank"><i class="fa fa-facebook fa-lg" title="facebook"></i> facebook </a></li><li><a href="https://twitter.com/lgwapnitsky" target="_blank"><i class="fa fa-twitter fa-lg" title="twitter"></i> twitter </a></li><li><a href="https://www.youtube.com/user/lgwapnitsky/" target="_blank"><i class="fa fa-youtube fa-lg" title="youtube"></i> youtube </a></li><li><a href="https://instagram.com/larrygwapnitsky/" target="_blank"><i class="fa fa-instagram fa-lg" title="instagram"></i> instagram </a></li><li><a href="https://github.com/lgwapnitsky" target="_blank"><i class="fa fa-github-alt fa-lg" title="github"></i> github </a></li><li><a href="https://stackexchange.com/users/216986/larry-g-wapnitsky" target="_blank"><i class="fa fa-stack-exchange fa-lg" title="StackExchange"></i> StackExchange </a></li><li><a href="https://goodreads.com/lgwapnitsky" target="_blank"><i class="fa fa-book fa-lg" title="goodreads"></i> goodreads </a></li></ul><div class="fb-page" data-href="https://www.facebook.com/LGWapnitsky" data-hide-cover="false" data-show-facepile="false" data-show-posts="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/LGWapnitsky"><a href="https://www.facebook.com/LGWapnitsky">The Whopper&#039;s Home</a></blockquote></div></div><div class="fb-page" data-href="https://www.facebook.com/pages/Low-And-Slow-Team/768664366560763" data-hide-cover="false" data-show-facepile="true" data-show-posts="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/pages/Low-And-Slow-Team/768664366560763"><a href="https://www.facebook.com/pages/Low-And-Slow-Team/768664366560763">Low And Slow Team</a></blockquote></div></div><a class="twitter-timeline" data-dnt="true" href="https://twitter.com/lgwapnitsky" data-widget-id="572867687229091840">Tweets by @lgwapnitsky</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></div></div> <h4><i class="fa fa-rss fa-fw fa-lg"></i> Feeds</h4><ul class="list-unstyled"><li><a href="http://larry.wapnitsky.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"><i class="fa fa-rss-square fa-fw fa-lg"></i> Atom Feed</a></li></ul><hr></div></div></div><footer id="site-footer"><address id="site-colophon"><p class="text-center text-muted"> Site built using <a href="http://getpelican.com/" target="_blank">Pelican</a>&nbsp;&bull;&nbsp; Theme based on <a href="http://www.voidynullness.net/page/voidy-bootstrap-pelican-theme/" target="_blank">VoidyBootstrap</a> by <a href="http://www.robertiwancz.com/" target="_blank">RKI</a></p></address></footer><script type="text/javascript">
		var pkBaseURL = "piwik.wapnitsky.com";
	var _paq = _paq || [];
	_paq.push(["trackPageView"]);
	_paq.push(["enableLinkTracking"]);
	(function() {
		var u=(("https:" == document.location.protocol) ? "https" : "http")+"://"+pkBaseURL+"/";
		_paq.push(["setTrackerUrl", u+"piwik.php"]);
		_paq.push(["setSiteId", "1"]);
		var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
		g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
	})();
	</script><script type="text/javascript">
    var disqus_shortname = 'larrygwapnitsky';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script><div id="fb-root"></div><script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=105212313145043";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script></body></html>